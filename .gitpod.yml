# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:
  - name: Restore .env file
    command: |
      if [ -f .env ]; then
        # If this workspace already has a .env, don't override it
        # Local changes survive a workspace being opened and closed
        # but they will not persist between separate workspaces for the same repo
        echo "Found .env in workspace"
      else
        if [ -z "${DATABASE_URL}" ]; then
          # There is no $DATABASE_URL from a previous workspace
          # Default to the example .env
          echo "Setting example .env"
          cp .env.example .env
        else
          # After making changes to .env, run this line to persist it to $DATABASE_URL
          #   gp env DATABASE_URL="$(base64 .env | tr -d '\n')"
          #
          # Environment variables set this way are shared between all your workspaces for this repo
          # The lines below will read $DATABASE_URL and print a .env file
          echo "Restoring .env from Gitpod"
          gp env > .env
        fi
      fi
  - init: yarn install && yarn run build
    command: yarn start